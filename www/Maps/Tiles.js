require(['jquery', 'org.tts.js.lodash', '@Maps/leaflet', 'turf', 'org.tts.js.Maps', 'style!@Maps/leaflet', 'style!@Maps/Maps.css'], ($, _, L, Turf, Maps) => {
	let ellenPeak = {lat: 38.12262, lng: -110.81344}
	let feature = {type:'Feature',id:'way/bd5ec3e3-2ed4-48e9-a023-03d85546b97c',properties:{type:'way',id:'bd5ec3e3-2ed4-48e9-a023-03d85546b97c',tags:{},relations:[],meta:{}},geometry:{type:'LineString',coordinates:[[-110.79842,38.121096,0],[-110.797149,38.119732,0],[-110.796432,38.11922,0],[-110.795767,38.118449,0],[-110.794813,38.117306,0],[-110.794712,38.116768,0],[-110.795769,38.116222,0],[-110.797084,38.116037,0],[-110.796773,38.11557,0],[-110.796238,38.115246,0],[-110.795894,38.114944,0],[-110.795441,38.114518,0],[-110.79459,38.113972,0],[-110.794543,38.113835,0],[-110.794598,38.11348,0],[-110.794618,38.113451,0],[-110.794795,38.113144,0],[-110.794825,38.113106,0],[-110.795124,38.11289,0],[-110.795138,38.112771,0],[-110.794425,38.112748,0],[-110.793895,38.112849,0],[-110.793301,38.112775,0],[-110.793027,38.112884,0],[-110.79237,38.113289,0],[-110.792102,38.113276,0],[-110.791699,38.113202,0],[-110.791613,38.113104,0],[-110.791522,38.113065,0],[-110.791152,38.113042,0],[-110.791086,38.113021,0],[-110.790845,38.112854,0],[-110.790815,38.112672,0],[-110.790646,38.112549,0],[-110.790478,38.112606,0],[-110.790278,38.112731,0],[-110.790045,38.112766,0],[-110.789277,38.112719,0],[-110.78917,38.112791,0],[-110.789204,38.112864,0],[-110.789405,38.113021,0],[-110.789421,38.113174,0],[-110.789388,38.113313,0],[-110.789195,38.113358,0],[-110.789034,38.113374,0],[-110.788807,38.113319,0],[-110.788716,38.113277,0],[-110.788177,38.112937,0],[-110.788071,38.112828,0],[-110.787832,38.112783,0],[-110.78777,38.112728,0],[-110.787664,38.112661,0],[-110.787609,38.112617,0],[-110.786432,38.111862,0],[-110.786235,38.111985,0],[-110.78608,38.112119,0],[-110.785728,38.112176,0],[-110.785503,38.112131,0],[-110.785314,38.112177,0],[-110.784725,38.112397,0],[-110.784478,38.112227,0],[-110.784437,38.111948,0],[-110.784181,38.112092,0],[-110.784123,38.112235,0],[-110.783838,38.112033,0],[-110.7836,38.111639,0],[-110.783354,38.111426,0],[-110.783291,38.111252,0],[-110.783063,38.111123,0],[-110.782766,38.111153,0],[-110.782284,38.1116,0],[-110.781787,38.112086,0],[-110.781469,38.112521,0],[-110.780665,38.112652,0],[-110.780185,38.113059,0],[-110.779654,38.112967,0],[-110.779702,38.112469,0],[-110.77942,38.112571,0],[-110.778314,38.113245,0],[-110.778138,38.111978,0],[-110.777809,38.111928,0],[-110.77751,38.11204,0],[-110.777372,38.111712,0],[-110.776965,38.111462,0],[-110.776748,38.111336,0]]}}

	let tts = L.tileLayer('http://localhost:2100/tiles/{id}/{z}/{x}/{y}', {
		maxZoom: 18,
		minZoom: 10,
		id: 'satellite-v9',
		tileSize: 512,
		zoomOffset: -1
	})

	let map = L.map('map', {center: [38.12262, -110.81344], zoom: 13, layers: [tts]})

	let tileOutlineStyle = JSON.parse('{"color":"#ff0000","opacity":0.8,"weight":5,"fillColor":"#ffffff","fillOpacity":0.0}')
	let tileOutlines = []
	function DrawTileOutlines (zoom) {
		tileOutlines.forEach(layer => {map.removeLayer(layer)})
		let centerTile = new Maps.Tile([map.getCenter().lng, map.getCenter().lat], zoom)
		for (let i=-10; i<=10; i++) {
			for (let j=-10; j<=10; j++) {
				let tile = new Maps.Tile(centerTile.slippy[0], centerTile.slippy[1]+i, centerTile.slippy[2]+j)
				let _tile = Turf.bboxPolygon([tile.bounds.minlon, tile.bounds.minlat, tile.bounds.maxlon, tile.bounds.maxlat])
				let tileLayer = L.geoJSON(_tile, {style: () => {return tileOutlineStyle}}).addTo(map)
				tileLayer.on('click', (e) => {
					e.originalEvent.preventDefault()
					e.originalEvent.stopPropagation()
					tileLayer.setStyle({fillOpacity: 0.3})
				})
				tileLayer.on('dblclick', (e) => {
					alert(tile.key)
				})
				tileOutlines.push(tileLayer)
			}
		}
	}

	DrawTileOutlines(15)



	window.map = map

	$(() => {

	})
})


